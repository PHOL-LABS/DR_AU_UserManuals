\chapter{miniUIOD configuration and maintenance}\label{ch:replica-next-setup}

The miniUIOD module adds a Wi-Fi configuration interface to the \DRAudi{} dashboard.
The hardware layout is shown in \autoref{fig:next-hardware}.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.6\textwidth]{figures/digifizaudi/image019.png}
    \caption{miniUIOD controller installed inside the \DRAudi{} dashboard.}
    \label{fig:next-hardware}
\end{figure}

\section{Panel handling}
\begin{itemize}
    \item Protect the UV-printed polycarbonate faceplate from scratches and foreign objects. Significant damage requires replacement parts from PHOL-LABS Kft and is not treated as a warranty case.
    \item The real-time clock is configured via the Wi-Fi control panel. It resets whenever the permanent supply is disconnected.
\end{itemize}

\section{Wi-Fi control portal}
Configuration, data collection, and firmware management are performed through the embedded web application.
\begin{itemize}
    \item Connect to the dashboard's Wi-Fi access point. Disable mobile data and join \texttt{Digifiz\_AP} (password \texttt{87654321}); some revisions advertise \texttt{PHOL-LABS2} with the same password.
    \item The default IP address is \texttt{192.168.4.1}. If the dashboard is configured to join another network, scan the subnet for an address ending in \texttt{.32} using an IP tools application.
    \item The portal contains the tabs \emph{WiFi}, \emph{Control}, \emph{Settings}, \emph{Colors}, and \emph{About} (\autoref{fig:next-control-tabs}). The Wi-Fi tab configures network settings and handles firmware uploads; the Control tab adjusts dashboard parameters; the Settings tab provides a structured editor for all firmware parameters; the Colors tab manages multi-segment colour schemes; the About tab lists author information.
\end{itemize}

\begin{figure}[htbp]
    \centering
    \begin{subfigure}{0.48\textwidth}
        \includegraphics[width=\linewidth]{figures/digifizaudi/image020.png}
        \caption{Control tab overview.}
    \end{subfigure}\hfill
    \begin{subfigure}{0.48\textwidth}
        \includegraphics[width=\linewidth]{figures/digifizaudi/image021.png}
        \caption{Numbered controls and command entry fields.}
    \end{subfigure}
    \caption{miniUIOD Wi-Fi control interface.}
    \label{fig:next-control-tabs}
\end{figure}

\section{Command entry}
The \emph{Control} tab provides a command input line (1), a \emph{Process} button (2), a result window (3), quick controls (4), a \emph{Save} button (5), and a \emph{Reset} button (6).
Enter commands as space-separated pairs \verb|<number> <value>| using integers only; punctuation and quotation marks are not required.
\autoref{fig:next-command-example} illustrates the interface while toggling automatic brightness.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.55\textwidth]{figures/digifizaudi/image022.png}
    \caption{Example command sequence disabling automatic brightness.}
    \label{fig:next-command-example}
\end{figure}

\section{Command reference}
\begin{table}[htbp]
    \centering
    \caption{Primary miniUIOD configuration commands.}
    \label{tbl:next-commands}
    {\scriptsize
    \begin{tblr}{
        colspec = {Q[c,0.14\linewidth] Q[l,0.34\linewidth] Q[l,0.5\linewidth]},
        rowsep = 2pt,
    }
        \toprule
        \textbf{Command} & \textbf{Name} & \textbf{Description} \\
        \midrule
        22 (or 0) & \paramname{PARAMETER\_RPMCOEFFICIENT} & Engine RPM calibration factor (100--10000). \\
        1  & \paramname{PARAMETER\_SPEEDCOEEFICIENT} & Speed calibration factor (10--255). \\
        2  & \paramname{PARAMETER\_COOLANTTHERMISTORB} & Coolant thermistor beta coefficient (2000--5000). \\
        3  & \paramname{PARAMETER\_OILTHERMISTORB} & Oil thermistor beta coefficient (2000--5000). \\
        4  & \paramname{PARAMETER\_AIRTHERMISTORB} & Ambient thermistor beta coefficient (2000--5000). \\
        5  & \paramname{PARAMETER\_TANKMINRESISTANCE} & Minimum fuel sender resistance (0--1000~\ohm). \\
        6  & \paramname{PARAMETER\_TANKMAXRESISTANCE} & Maximum fuel sender resistance (100--1000~\ohm). \\
        7  & \paramname{PARAMETER\_TAU\_COOLANT} & Coolant temperature filter constant (1--50). \\
        8  & \paramname{PARAMETER\_TAU\_OIL} & Oil temperature filter constant (1--50). \\
        9  & \paramname{PARAMETER\_TAU\_AIR} & Ambient temperature filter constant (1--50). \\
        10 & \paramname{PARAMETER\_TAU\_TANK} & Fuel level filter constant (1--50). \\
        11 & \paramname{PARAMETER\_MILEAGE} & Total odometer value (0--999999). \\
        12 & \paramname{PARAMETER\_DAILY\_MILEAGE} & Trip odometer (0--9999). \\
        13 & \paramname{PARAMETER\_AUTO\_BRIGHTNESS} & Automatic brightness enable (1=on, 0=off). \\
        14 & \paramname{PARAMETER\_BRIGHTNESS\_LEVEL} & Manual brightness level (0--60\%; values above 60 reduce LED life). \\
        15 & \paramname{PARAMETER\_TANK\_CAPACITY} & Fuel tank capacity in litres (0--99). \\
        16 & \paramname{PARAMETER\_MFA\_STATE} & Active MFA mode (normally controlled via hardware input). \\
        17 & \paramname{PARAMETER\_BUZZER\_OFF} & Disable buzzer (1 disables, 0 enables). \\
        18 & \paramname{PARAMETER\_MAX\_RPM} & Tachometer scaling (typical 7000 or 8000). \\
        19 & \paramname{PARAMETER\_NORMAL\_RESISTANCE\_COOLANT} & Coolant sensor resistance at \SI{25}{\celsius} (1000--10000~\ohm). \\
        20 & \paramname{PARAMETER\_NORMAL\_RESISTANCE\_OIL} & Oil sensor resistance at \SI{25}{\celsius} (1000--10000~\ohm). \\
        21 & \paramname{PARAMETER\_NORMAL\_RESISTANCE\_AMB} & Ambient sensor resistance at \SI{25}{\celsius} (1000--10000~\ohm). \\
        23 & \paramname{PARAMETER\_DOT\_OFF} & Clock colon behaviour (0=blink, 1=solid). \\
        24 & \paramname{PARAMETER\_BACKLIGHT\_ON} & Enable backlight on low beam. \\
        25 & \paramname{PARAMETER\_M\_D\_FILTER} & Median filter constant (legacy, normally unused). \\
        26 & \paramname{PARAMETER\_COOLANT\_MAX\_R} & Coolant sensor threshold for full-scale indication. \\
        27 & \paramname{PARAMETER\_COOLANT\_MIN\_R} & Coolant sensor threshold for ``1~bar'' indication. \\
        31--33 & \paramname{PARAMETER\_MAINCOLOR\_[RGB]} & User interface colour components. \\
        37 & \paramname{PARAMETER\_RPM\_FILTER} & RPM filter aggressiveness (10--200). \\
        128 & \paramname{PARAMETER\_READ\_ADDITION} & Add 128 to read the current value of any command. \\
        255 & \paramname{PARAMETER\_SET\_HOUR} & Set clock hours (24-hour format). \\
        254 & \paramname{PARAMETER\_SET\_MINUTE} & Set clock minutes. \\
        253 & \paramname{PARAMETER\_RESET\_DAILY\_MILEAGE} & Reset the trip odometer. \\
        252 & \paramname{PARAMETER\_RESET\_DIGIFIZ} & Factory reset of stored parameters. \\
        \bottomrule
    \end{tblr}}
\end{table}

\section{Default values}
\begin{table}[htbp]
    \centering
    \caption{Default miniUIOD settings for the \DRAudi{} dashboard.}
    \label{tbl:next-defaults}
    {\scriptsize
    \begin{tblr}{
        colspec = {Q[l,0.42\linewidth] Q[c,0.15\linewidth] Q[l,0.43\linewidth]},
        rowsep = 2pt,
    }
        \toprule
        \textbf{Parameter} & \textbf{Default} & \textbf{Notes} \\
        \midrule
        \paramname{PARAMETER\_RPMCOEFFICIENT} & 3000 & Typical for Audi ignition inputs. \\
        \paramname{PARAMETER\_SPEEDCOEEFICIENT} & 100 & Calibrated for \SI{100}{\kilo\metre\per\hour}. \\
        \paramname{PARAMETER\_COOLANTTHERMISTORB} & 4000 &  \\
        \paramname{PARAMETER\_OILTHERMISTORB} & 4000 &  \\
        \paramname{PARAMETER\_AIRTHERMISTORB} & 3812 &  \\
        \paramname{PARAMETER\_TANKMINRESISTANCE} & 35 & \si{\ohm}. \\
        \paramname{PARAMETER\_TANKMAXRESISTANCE} & 265 & \si{\ohm}. \\
        \paramname{PARAMETER\_TAU\_COOLANT} & 2 & Filter constant. \\
        \paramname{PARAMETER\_TAU\_OIL} & 2 & Filter constant. \\
        \paramname{PARAMETER\_TAU\_AIR} & 2 & Filter constant. \\
        \paramname{PARAMETER\_TAU\_TANK} & 2 & Filter constant. \\
        \paramname{PARAMETER\_MILEAGE} & Vehicle-specific & Retains stored odometer. \\
        \paramname{PARAMETER\_DAILY\_MILEAGE} & 0 &  \\
        \paramname{PARAMETER\_AUTO\_BRIGHTNESS} & 1 & Enabled. \\
        \paramname{PARAMETER\_BRIGHTNESS\_LEVEL} & 25 & Manual brightness (adjust if auto mode is disabled). \\
        \paramname{PARAMETER\_TANK\_CAPACITY} & 63 & Litres. \\
        \paramname{PARAMETER\_MFA\_STATE} & 0 & Default MFA page. \\
        \paramname{PARAMETER\_BUZZER\_OFF} & 1 & Buzzer disabled. \\
        \paramname{PARAMETER\_MAX\_RPM} & 8000 & Tachometer scale. \\
        \paramname{PARAMETER\_NORMAL\_RESISTANCE\_COOLANT} & 1000 & \si{\ohm} at \SI{25}{\celsius}. \\
        \paramname{PARAMETER\_NORMAL\_RESISTANCE\_OIL} & 1000 & \si{\ohm} at \SI{25}{\celsius}. \\
        \paramname{PARAMETER\_NORMAL\_RESISTANCE\_AMB} & 2991 & \si{\ohm} at \SI{25}{\celsius}. \\
        \paramname{PARAMETER\_DOT\_OFF} & 0 & Blinking clock colon. \\
        \paramname{PARAMETER\_BACKLIGHT\_ON} & 1 & Backlight enabled with low beam. \\
        \paramname{PARAMETER\_M\_D\_FILTER} & 65535 & Legacy median filter constant. \\
        \paramname{PARAMETER\_COOLANT\_MAX\_R} & 120 & \si{\celsius}. \\
        \paramname{PARAMETER\_COOLANT\_MIN\_R} & 60 & \si{\celsius}. \\
        \paramname{PARAMETER\_MAINCOLOR\_R} & 180 & Yellow-green default. \\
        \paramname{PARAMETER\_MAINCOLOR\_G} & 240 & Yellow-green default. \\
        \paramname{PARAMETER\_MAINCOLOR\_B} & 6 & Yellow-green default. \\
        \paramname{PARAMETER\_RPM\_FILTER} & 70 & Filter response. \\
        \paramname{PARAMETER\_UPTIME} & 0 & Runtime counter. \\
        \bottomrule
    \end{tblr}}
\end{table}

\section{Reading parameters and examples}
To read a parameter, add 128 to the command number (for example, \verb|129 0| reports the speed coefficient).
Typical commands include disabling automatic brightness (\verb|13 0|), enabling it again (\verb|13 1|), adjusting the speed coefficient (\verb|1 110| increases the displayed speed by 10\%), and setting the odometer (\verb|11 123456|).
Clock values are set with \verb|255 <hours>| followed by \verb|254 <minutes>|.

\section{Service commands}
Recent firmware revisions accept human-readable parameter names, for example \verb|PARAMETER_RPMCOEFFICIENT 3000|.
The diagnostic command \verb|adc 0| prints raw ADC readings for sensor troubleshooting.
Firmware updates add visual colour controls, so update regularly through the \emph{WiFi} tab to access the latest features.

\section{Settings tab parameter editor}
The \emph{Settings} tab mirrors the parameter list in \autoref{tbl:next-commands} and \autoref{tbl:next-defaults} while adding metadata about ranges, descriptions, and data types.
Use it whenever you prefer a graphical workflow instead of typing command numbers.

\section{Custom colour schemes}
The \emph{Colors} tab introduces a segment-based editor for the WS2812 LED backlight.
Press \emph{Load Scheme} to read the active mapping, adjust the ranges, and use \emph{Set Scheme} to upload the new layout.
Immediately switch to the \emph{Control} tab and press \emph{Save parameters}; otherwise the scheme is lost after a reboot.
Optional export/import buttons let you back up the JSON representation of the layout.

If you later disable the custom colour scheme flag in the \emph{Settings} tab, the dashboard falls back to the classic single-colour mode driven by \verb|PARAMETER_MAINCOLOR_R/G/B|.
